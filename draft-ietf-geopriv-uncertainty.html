<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>Representation of Uncertainty and Confidence in PIDF-LO </title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
      /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
      a.info {
          /* This is the key. */
          position: relative;
          z-index: 24;
          text-decoration: none;
      }
      a.info:hover {
          z-index: 25;
          color: #FFF; background-color: #900;
      }
      a.info span { display: none; }
      a.info:hover span.info {
          /* The span will display just on :hover state. */
          display: block;
          position: absolute;
          font-size: smaller;
          top: 2em; left: -5em; width: 15em;
          padding: 2px; border: 1px solid #333;
          color: #900; background-color: #EEE;
          text-align: left;
      }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  max-width: 55em;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style><style tyle="text/css">body {   font: 11pt cambria, helvetica, arial, sans-serif;   font-size-adjust: 0.5;   line-height: 130%;   margin: 1em auto;   max-width: 700px; }  .title, .filename, h1, h2, h3, h4 {   font-family: candara, helvetica, arial, sans-serif;   font-size-adjust: 0.5; } .title { font-size: 150%; } h1 { font-size: 130%; } h2 { font-size: 120%; } h3, h4 { font-size: 110%; } ul.toc >li { font-size: 95%; } ul.toc >li >ul, .figure, caption { font-size: 90%; }  table {   margin-left: 0em; } table.header {   width: 100%; }  table.header td {   background-color: inherit;   color: black; }  samp, tt, code, pre {   font: 11pt consolas, monospace;   font-size-adjust: none; }  pre.text, pre.text2 {   width: 90%; }  dt {   float: left; clear: left;   margin: 0.5em 0.5em 0 0; } dt:first-child {   margin-top: 0; } dd {   margin: 0.5em 0 0 2em; } dd p, dd ul {   margin-top: 0; margin-bottom: 0; } dd *+p {   margin-top: 0.5em; }  ol, ul {   padding: 0;   margin: 0.5em 0 0.5em 2em; } ol ol, ol ul, ul ul, ul ol {   margin-left: 0; } ul.toc, ul.toc ul {    margin: 0 0 0 1.5em; } ul.toc a:first-child {    display: inline-block;    min-width: 1.2em; }</style>

  <link href="#rfc.toc" rel="Contents"/>
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction"/>
<link href="#rfc.section.1.1" rel="Chapter" title="1.1 Conventions and Terminology"/>
<link href="#rfc.section.2" rel="Chapter" title="2 A General Definition of Uncertainty"/>
<link href="#rfc.section.2.1" rel="Chapter" title="2.1 Uncertainty as a Probability Distribution"/>
<link href="#rfc.section.2.2" rel="Chapter" title="2.2 Deprecation of the Terms Precision and Resolution"/>
<link href="#rfc.section.2.3" rel="Chapter" title="2.3 Accuracy as a Qualitative Concept"/>
<link href="#rfc.section.3" rel="Chapter" title="3 Uncertainty in Location"/>
<link href="#rfc.section.3.1" rel="Chapter" title="3.1 Targets as Points in Space"/>
<link href="#rfc.section.3.2" rel="Chapter" title="3.2 Representation of Uncertainty and Confidence in PIDF-LO"/>
<link href="#rfc.section.3.3" rel="Chapter" title="3.3 Uncertainty and Confidence for Civic Addresses"/>
<link href="#rfc.section.3.4" rel="Chapter" title="3.4 DHCP Location Configuration Information and Uncertainty"/>
<link href="#rfc.section.4" rel="Chapter" title="4 Representation of Confidence in PIDF-LO"/>
<link href="#rfc.section.4.1" rel="Chapter" title="4.1 The &quot;confidence&quot; Element"/>
<link href="#rfc.section.4.2" rel="Chapter" title="4.2 Generating Locations with Confidence"/>
<link href="#rfc.section.4.3" rel="Chapter" title="4.3 Consuming and Presenting Confidence"/>
<link href="#rfc.section.5" rel="Chapter" title="5 Manipulation of Uncertainty"/>
<link href="#rfc.section.5.1" rel="Chapter" title="5.1 Reduction of a Location Estimate to a Point"/>
<link href="#rfc.section.5.1.1" rel="Chapter" title="5.1.1 Centroid Calculation"/>
<link href="#rfc.section.5.1.1.1" rel="Chapter" title="5.1.1.1 Arc-Band Centroid"/>
<link href="#rfc.section.5.1.1.2" rel="Chapter" title="5.1.1.2 Polygon Centroid"/>
<link href="#rfc.section.5.2" rel="Chapter" title="5.2 Conversion to Circle or Sphere"/>
<link href="#rfc.section.5.3" rel="Chapter" title="5.3 Three-Dimensional to Two-Dimensional Conversion"/>
<link href="#rfc.section.5.4" rel="Chapter" title="5.4 Increasing and Decreasing Uncertainty and Confidence"/>
<link href="#rfc.section.5.4.1" rel="Chapter" title="5.4.1 Rectangular Distributions"/>
<link href="#rfc.section.5.4.2" rel="Chapter" title="5.4.2 Normal Distributions"/>
<link href="#rfc.section.5.5" rel="Chapter" title="5.5 Determining Whether a Location is Within a Given Region"/>
<link href="#rfc.section.5.5.1" rel="Chapter" title="5.5.1 Determining the Area of Overlap for Two Circles"/>
<link href="#rfc.section.5.5.2" rel="Chapter" title="5.5.2 Determining the Area of Overlap for Two Polygons"/>
<link href="#rfc.section.6" rel="Chapter" title="6 Examples"/>
<link href="#rfc.section.6.1" rel="Chapter" title="6.1 Reduction to a Point or Circle"/>
<link href="#rfc.section.6.2" rel="Chapter" title="6.2 Increasing and Decreasing Confidence"/>
<link href="#rfc.section.6.3" rel="Chapter" title="6.3 Matching Location Estimates to Regions of Interest"/>
<link href="#rfc.section.6.4" rel="Chapter" title="6.4 PIDF-LO With Confidence Example"/>
<link href="#rfc.section.7" rel="Chapter" title="7 Confidence Schema"/>
<link href="#rfc.section.8" rel="Chapter" title="8 IANA Considerations"/>
<link href="#rfc.section.8.1" rel="Chapter" title="8.1 URN Sub-Namespace Registration for urn:ietf:params:xml:ns:geopriv:conf"/>
<link href="#rfc.section.8.2" rel="Chapter" title="8.2 XML Schema Registration"/>
<link href="#rfc.section.9" rel="Chapter" title="9 Security Considerations"/>
<link href="#rfc.section.10" rel="Chapter" title="10 Acknowledgements"/>
<link href="#rfc.references" rel="Chapter" title="11 References"/>
<link href="#rfc.references.1" rel="Chapter" title="11.1 Normative References"/>
<link href="#rfc.references.2" rel="Chapter" title="11.2 Informative References"/>
<link href="#rfc.appendix.A" rel="Chapter" title="A Conversion Between Cartesian and Geodetic Coordinates in WGS84"/>
<link href="#rfc.appendix.B" rel="Chapter" title="B Calculating the Upward Normal of a Polygon"/>
<link href="#rfc.appendix.B.1" rel="Chapter" title="B.1 Checking that a Polygon Upward Normal Points Up"/>
<link href="#rfc.authors" rel="Chapter"/>


  <meta name="generator" content="xml2rfc version 2.4.8 - http://tools.ietf.org/tools/xml2rfc" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />

  <meta name="dct.creator" content="Thomson, M. and J. Winterbottom" />
  <meta name="dct.identifier" content="urn:ietf:id:draft-ietf-geopriv-uncertainty-latest" />
  <meta name="dct.issued" scheme="ISO8601" content="2014-7-9" />
  <meta name="dct.abstract" content="The key concepts of uncertainty and confidence as they pertain to location information are defined.  Methods for the manipulation of location estimates that include uncertainty information are outlined.  " />
  <meta name="description" content="The key concepts of uncertainty and confidence as they pertain to location information are defined.  Methods for the manipulation of location estimates that include uncertainty information are outlined.  " />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
  <td class="left">GEOPRIV</td>
  <td class="right">M. Thomson</td>
</tr>
<tr>
  <td class="left">Internet-Draft</td>
  <td class="right">Mozilla</td>
</tr>
<tr>
  <td class="left">Intended status: Standards Track</td>
  <td class="right">J. Winterbottom</td>
</tr>
<tr>
  <td class="left">Expires: January 10, 2015</td>
  <td class="right">Unaffiliated</td>
</tr>
<tr>
  <td class="left"></td>
  <td class="right">July 9, 2014</td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">Representation of Uncertainty and Confidence in PIDF-LO <br />
  <span class="filename">draft-ietf-geopriv-uncertainty-latest</span></p>
  
  <h1 id="rfc.abstract">
  <a href="#rfc.abstract">Abstract</a>
</h1>
<p>The key concepts of uncertainty and confidence as they pertain to location information are defined.  Methods for the manipulation of location estimates that include uncertainty information are outlined.  </p>
<h1 id="rfc.status">
  <a href="#rfc.status">Status of This Memo</a>
</h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet-Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on January 10, 2015.</p>
<h1 id="rfc.copyrightnotice">
  <a href="#rfc.copyrightnotice">Copyright Notice</a>
</h1>
<p>Copyright (c) 2014 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a></li>
<li>1.1.   <a href="#rfc.section.1.1">Conventions and Terminology</a></li>
<li>2.   <a href="#rfc.section.2">A General Definition of Uncertainty</a></li>
<li>2.1.   <a href="#rfc.section.2.1">Uncertainty as a Probability Distribution</a></li>
<li>2.2.   <a href="#rfc.section.2.2">Deprecation of the Terms Precision and Resolution</a></li>
<li>2.3.   <a href="#rfc.section.2.3">Accuracy as a Qualitative Concept</a></li>
<li>3.   <a href="#rfc.section.3">Uncertainty in Location</a></li>
<li>3.1.   <a href="#rfc.section.3.1">Targets as Points in Space</a></li>
<li>3.2.   <a href="#rfc.section.3.2">Representation of Uncertainty and Confidence in PIDF-LO</a></li>
<li>3.3.   <a href="#rfc.section.3.3">Uncertainty and Confidence for Civic Addresses</a></li>
<li>3.4.   <a href="#rfc.section.3.4">DHCP Location Configuration Information and Uncertainty</a></li>
<li>4.   <a href="#rfc.section.4">Representation of Confidence in PIDF-LO</a></li>
<li>4.1.   <a href="#rfc.section.4.1">The "confidence" Element</a></li>
<li>4.2.   <a href="#rfc.section.4.2">Generating Locations with Confidence</a></li>
<li>4.3.   <a href="#rfc.section.4.3">Consuming and Presenting Confidence</a></li>
<li>5.   <a href="#rfc.section.5">Manipulation of Uncertainty</a></li>
<li>5.1.   <a href="#rfc.section.5.1">Reduction of a Location Estimate to a Point</a></li>
<li>5.1.1.   <a href="#rfc.section.5.1.1">Centroid Calculation</a></li>
<li>5.1.1.1.   <a href="#rfc.section.5.1.1.1">Arc-Band Centroid</a></li>
<li>5.1.1.2.   <a href="#rfc.section.5.1.1.2">Polygon Centroid</a></li>
<li>5.2.   <a href="#rfc.section.5.2">Conversion to Circle or Sphere</a></li>
<li>5.3.   <a href="#rfc.section.5.3">Three-Dimensional to Two-Dimensional Conversion</a></li>
<li>5.4.   <a href="#rfc.section.5.4">Increasing and Decreasing Uncertainty and Confidence</a></li>
<li>5.4.1.   <a href="#rfc.section.5.4.1">Rectangular Distributions</a></li>
<li>5.4.2.   <a href="#rfc.section.5.4.2">Normal Distributions</a></li>
<li>5.5.   <a href="#rfc.section.5.5">Determining Whether a Location is Within a Given Region</a></li>
<li>5.5.1.   <a href="#rfc.section.5.5.1">Determining the Area of Overlap for Two Circles</a></li>
<li>5.5.2.   <a href="#rfc.section.5.5.2">Determining the Area of Overlap for Two Polygons</a></li>
<li>6.   <a href="#rfc.section.6">Examples</a></li>
<li>6.1.   <a href="#rfc.section.6.1">Reduction to a Point or Circle</a></li>
<li>6.2.   <a href="#rfc.section.6.2">Increasing and Decreasing Confidence</a></li>
<li>6.3.   <a href="#rfc.section.6.3">Matching Location Estimates to Regions of Interest</a></li>
<li>6.4.   <a href="#rfc.section.6.4">PIDF-LO With Confidence Example</a></li>
<li>7.   <a href="#rfc.section.7">Confidence Schema</a></li>
<li>8.   <a href="#rfc.section.8">IANA Considerations</a></li>
<li>8.1.   <a href="#rfc.section.8.1">URN Sub-Namespace Registration for urn:ietf:params:xml:ns:geopriv:conf</a></li>
<li>8.2.   <a href="#rfc.section.8.2">XML Schema Registration</a></li>
<li>9.   <a href="#rfc.section.9">Security Considerations</a></li>
<li>10.   <a href="#rfc.section.10">Acknowledgements</a></li>
<li>11.   <a href="#rfc.references">References</a></li>
<li>11.1.   <a href="#rfc.references.1">Normative References</a></li>
<li>11.2.   <a href="#rfc.references.2">Informative References</a></li>
<li>Appendix A.   <a href="#rfc.appendix.A">Conversion Between Cartesian and Geodetic Coordinates in WGS84</a></li>
<li>Appendix B.   <a href="#rfc.appendix.B">Calculating the Upward Normal of a Polygon</a></li>
<li>B.1.   <a href="#rfc.appendix.B.1">Checking that a Polygon Upward Normal Points Up</a></li>
<li><a href="#rfc.authors">Authors' Addresses</a></li>


  </ul>

  <h1 id="rfc.section.1"><a href="#rfc.section.1">1.</a> <a href="#intro" id="intro">Introduction</a></h1>
<p id="rfc.section.1.p.1">Location information represents an estimation of the position of a <a href="#RFC6280">Target</a> <cite title="NONE">[RFC6280]</cite>.  Under ideal circumstances, a location estimate precisely reflects the actual location of the Target.  For automated systems that determine location, there are many factors that introduce errors into the measurements that are used to determine location estimates.  </p>
<p id="rfc.section.1.p.2">The process by which measurements are combined to generate a location estimate is outside of the scope of work within the IETF.  However, the results of such a process are carried in IETF data formats and protocols.  This document outlines how uncertainty, and its associated datum, confidence, are expressed and interpreted.  </p>
<p id="rfc.section.1.p.3">This document provides a common nomenclature for discussing uncertainty and confidence as they relate to location information.  </p>
<p id="rfc.section.1.p.4">This document also provides guidance on how to manage location information that includes uncertainty.  Methods for expanding or reducing uncertainty to obtain a required level of confidence are described.  Methods for determining the probability that a Target is within a specified region based on their location estimate are described.  These methods are simplified by making certain assumptions about the location estimate and are designed to be applicable to location estimates in a relatively small geographic area.  </p>
<p id="rfc.section.1.p.5">A confidence extension for the <a href="#RFC4119">Presence Information Data Format - Location Object (PIDF-LO)</a> <cite title="NONE">[RFC4119]</cite> is described.  </p>
<p id="rfc.section.1.p.6">This document describes methods that can be used in combination with automatically determined location information.  These are statistically-based methods.  </p>
<h1 id="rfc.section.1.1"><a href="#rfc.section.1.1">1.1.</a> <a href="#terminology" id="terminology">Conventions and Terminology</a></h1>
<p id="rfc.section.1.1.p.1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in <a href="#RFC2119">[RFC2119]</a>.  </p>
<p id="rfc.section.1.1.p.2">This document assumes a basic understanding of the principles of mathematics, particularly statistics and geometry.  </p>
<p id="rfc.section.1.1.p.3">Some terminology is borrowed from <a href="#RFC3693">[RFC3693]</a> and <a href="#RFC6280">[RFC6280]</a>, in particular Target.  </p>
<p id="rfc.section.1.1.p.4">Mathematical formulae are presented using the following notation: add <samp>+</samp>, subtract <samp>-</samp>, multiply <samp>*</samp>, divide <samp>/</samp>, power <samp>^</samp> and absolute value <samp>|x|</samp>.  Precedence is indicated using parentheses.  Mathematical functions are represented by common abbreviations: square root <samp>sqrt(x)</samp>, sine <samp>sin(x)</samp>, cosine <samp>cos(x)</samp>, inverse cosine <samp>acos(x)</samp>, tangent <samp>tan(x)</samp>, inverse tangent <samp>atan(x)</samp>, two-argument inverse tangent <samp>atan2(y,x)</samp>, error function <samp>erf(x)</samp>, and inverse error function <samp>erfinv(x)</samp>.  </p>
<h1 id="rfc.section.2"><a href="#rfc.section.2">2.</a> <a href="#general" id="general">A General Definition of Uncertainty</a></h1>
<p id="rfc.section.2.p.1">Uncertainty results from the limitations of measurement.  In measuring any observable quantity, errors from a range of sources affect the result.  Uncertainty is a quantification of what is known about the observed quantity, either through the limitations of measurement or through inherent variability of the quantity.  </p>
<p id="rfc.section.2.p.2">Uncertainty is most completely described by a probability distribution.  A probability distribution assigns a probability to possible values for the quantity.  </p>
<p id="rfc.section.2.p.3">A probability distribution describing a measured quantity can be arbitrarily complex and so it is desirable to find a simplified model.  One approach commonly taken is to reduce the probability distribution to a confidence interval.  Many alternative models are used in other areas, but study of those is not the focus of this document.  </p>
<p id="rfc.section.2.p.4">In addition to the central estimate of the observed quantity, a confidence interval is succinctly described by two values: an error range and a confidence.  The error range describes an interval and the confidence describes an estimated upper bound on the probability that a "true" value is found within the extents defined by the error.  </p>
<p id="rfc.section.2.p.5">In the following example, a measurement result for a length is shown as a nominal value with additional information on error range (0.0043 meters) and confidence (95%).  <samp>x</samp> between 1.00312 and 1.01172 meters with 95% probability.  No other assertion is made: in particular, this does not assert that x is 1.00742.  </p>

<ul class="empty">
  <li>e.g.  x = 1.00742 +/- 0.0043 meters at 95% confidence </li>
</ul>

<p> This result indicates that the measurement indicates that the value of </p>
<p id="rfc.section.2.p.6">Uncertainty and confidence for location estimates can be derived in a number of ways.  This document does not attempt to enumerate the many methods for determining uncertainty.  <a href="#ISO.GUM">[ISO.GUM]</a> and <a href="#NIST.TN1297">[NIST.TN1297]</a> provide a set of general guidelines for determining and manipulating measurement uncertainty.  This document applies that general guidance for consumers of location information.  </p>
<p id="rfc.section.2.p.7">As a statistical measure, values determined for uncertainty are determined based on information in the aggregate, across numerous individual estimates.  An individual estimate might be determined to be "correct" - by using a survey to validate the result, for example - without invalidating the statistical assertion.  </p>
<p id="rfc.section.2.p.8">This understanding of estimates in the statistical sense explains why asserting a confidence of 100%, which might seem intuitively correct, is rarely advisable.  </p>
<h1 id="rfc.section.2.1"><a href="#rfc.section.2.1">2.1.</a> Uncertainty as a Probability Distribution</h1>
<p id="rfc.section.2.1.p.1">The Probability Density Function (PDF) that is described by uncertainty indicates the probability that the "true" value lies at any one point.  The shape of the probability distribution can vary depending on the method that is used to determine the result.  The two probability density functions most generally applicable to location information are considered in this document: </p>

<ul>
  <li>The normal PDF (also referred to as a Gaussian PDF) is used where a large number of small random factors contribute to errors.  The value used for the error range in a normal PDF is related to the standard deviation of the distribution.  </li>
  <li>A rectangular PDF is used where the errors are known to be consistent across a limited range.  A rectangular PDF can occur where a single error source, such as a rounding error, is significantly larger than other errors.  A rectangular PDF is often described by the half-width of the distribution; that is, half the width of the distribution.  </li>
</ul>

<p> </p>
<p id="rfc.section.2.1.p.2">Each of these probability density functions can be characterized by its center point, or mean, and its width.  For a normal distribution, uncertainty and confidence together are related to the standard deviation (see <a href="#scaling">Section 5.4</a>).  For a rectangular distribution, half of the width of the distribution is used.  </p>
<p><a href="#pdf">Figure 1</a> shows a normal and rectangular probability density function with the mean (m) and standard deviation (s) labelled.  The half-width (h) of the rectangular distribution is also indicated.  </p>
<div id="rfc.figure.1"/>
<div id="pdf"/>
<pre>
                             *****             *** Normal PDF
                           **  :  **           --- Rectangular PDF
                         **    :    **
                        **     :     **
             .---------*---------------*---------.
             |        **       :       **        |
             |       **        :        **       |
             |      * &lt;-- s --&gt;:          *      |
             |     * :         :         : *     |
             |    **           :           **    |
             |   *   :         :         :   *   |
             |  *              :              *  |
             |**     :         :         :     **|
            **                 :                 **
         *** |       :         :         :       | ***
     *****   |                 :&lt;------ h ------&gt;|   *****
 .****-------+.......:.........:.........:.......+-------*****.
                               m
                               </pre>
<p class="figure">Figure 1: Normal and Rectangular Probability Density Functions</p>
<p id="rfc.section.2.1.p.4">For a given PDF, the value of the PDF describes the probability that the "true" value is found at that point.  Confidence for any given interval is the total probability of the "true" value being in that range, defined as the integral of the PDF over the interval.  <a href="#pdfintegral">Figure 2</a> shows how confidence is determined for a normal distribution.  The area of the shaded region gives the confidence (c) for the interval between <samp>m-u</samp> and <samp>m+u</samp>.  </p>

<ul class="empty">
  <li>The probability of the "true" value falling between two points is found by finding the area under the curve between the points (that is, the integral of the curve between the points).  For any given PDF, the area under the curve for the entire range from negative infinity to positive infinity is 1 or (100%).  Therefore, the confidence over any interval of uncertainty is always less than 100%.  </li>
</ul>

<p> </p>
<div id="rfc.figure.2"/>
<div id="pdfintegral"/>
<pre>
                             *****
                           **:::::**
                         **:::::::::**
                        **:::::::::::**
                       *:::::::::::::::*
                      **:::::::::::::::**
                     **:::::::::::::::::**
                    *:::::::::::::::::::::*
                   *:::::::::::::::::::::::*
                  **:::::::::::::::::::::::**
                 *:::::::::::: c ::::::::::::*
                *:::::::::::::::::::::::::::::*
              **|:::::::::::::::::::::::::::::|**
            **  |:::::::::::::::::::::::::::::|  **
         ***    |:::::::::::::::::::::::::::::|    ***
     *****      |:::::::::::::::::::::::::::::|      *****
 .****..........!:::::::::::::::::::::::::::::!..........*****.
                |              |              |
              (m-u)            m            (m+u)
</pre>
<p class="figure">Figure 2: Confidence as the Integral of a PDF</p>
<p id="rfc.section.2.1.p.5">In <a href="#scaling">Section 5.4</a>, methods are described for manipulating uncertainty if the shape of the PDF is known.  </p>
<h1 id="rfc.section.2.2"><a href="#rfc.section.2.2">2.2.</a> Deprecation of the Terms Precision and Resolution</h1>
<p id="rfc.section.2.2.p.1">The terms <em>Precision</em> and <em>Resolution</em> are defined in <a href="#RFC3693">RFC 3693</a> <cite title="NONE">[RFC3693]</cite>.  These definitions were intended to provide a common nomenclature for discussing uncertainty; however, these particular terms have many different uses in other fields and their definitions are not sufficient to avoid confusion about their meaning.  These terms are unsuitable for use in relation to quantitative concepts when discussing uncertainty and confidence in relation to location information.  </p>
<h1 id="rfc.section.2.3"><a href="#rfc.section.2.3">2.3.</a> Accuracy as a Qualitative Concept</h1>
<p id="rfc.section.2.3.p.1">Uncertainty is a quantitative concept.  The term <em>accuracy</em> is useful in describing, qualitatively, the general concepts of location information.  Accuracy is generally useful when describing qualitative aspects of location estimates.  Accuracy is not a suitable term for use in a quantitative context.  </p>
<p id="rfc.section.2.3.p.2">For instance, it could be appropriate to say that a location estimate with uncertainty <samp>X</samp> is more accurate than a location estimate with uncertainty <samp>2X</samp> at the same confidence.  It is not appropriate to assign a number to "accuracy", nor is it appropriate to refer to any component of uncertainty or confidence as "accuracy".  That is, to say that the "accuracy" for the first location estimate is <samp>X</samp> would be an erroneous use of this term.  </p>
<h1 id="rfc.section.3"><a href="#rfc.section.3">3.</a> <a href="#location" id="location">Uncertainty in Location</a></h1>
<p id="rfc.section.3.p.1">A <em>location estimate</em> is the result of location determination.  A location estimate is subject to uncertainty like any other observation.  However, unlike a simple measure of a one dimensional property like length, a location estimate is specified in two or three dimensions.  </p>
<p id="rfc.section.3.p.2">Uncertainty in two or three dimensional locations can be described using confidence intervals.  The confidence interval for a location estimate in two or three dimensional space is expressed as a subset of that space.  This document uses the term <em>region of uncertainty</em> to refer to the area or volume that describes the confidence interval.  </p>
<p id="rfc.section.3.p.3">Areas or volumes that describe regions of uncertainty can be formed by the combination of two or three one-dimensional ranges, or more complex shapes could be described (for example, the shapes in <a href="#RFC5491">[RFC5491]</a>).  </p>
<h1 id="rfc.section.3.1"><a href="#rfc.section.3.1">3.1.</a> Targets as Points in Space</h1>
<p id="rfc.section.3.1.p.1">This document makes a simplifying assumption that the Target of the PIDF-LO occupies just a single point in space.  While this is clearly false in virtually all scenarios with any practical application, it is often a reasonable simplifying assumption to make.  </p>
<p id="rfc.section.3.1.p.2">To a large extent, whether this simplification is valid depends on the size of the target relative to the size of the uncertainty region.  When locating a personal device using contemporary location determination techniques, the space the device occupies relative to the uncertainty is proportionally quite small.  Even where that device is used as a proxy for a person, the proportions change little.  </p>
<p id="rfc.section.3.1.p.3">This assumption is less useful as uncertainty becomes small relative to the size of the Target of the PIDF-LO (or conversely, as uncertainty becomes small relative to the Target).  For instance, describing the location of a football stadium or small country would include a region of uncertainty that is infinitesimally larger than the Target itself.  In these cases, much of the guidance in this document is not applicable.  Indeed, as the accuracy of location determination technology improves, it could be that the advice this document contains becomes less relevant by the same measure.  </p>
<h1 id="rfc.section.3.2"><a href="#rfc.section.3.2">3.2.</a> Representation of Uncertainty and Confidence in PIDF-LO</h1>
<p id="rfc.section.3.2.p.1">A set of shapes suitable for the expression of uncertainty in location estimates in the Presence Information Data Format - Location Object (PIDF-LO) are described in <a href="#GeoShape">[GeoShape]</a>.  These shapes are the recommended form for the representation of uncertainty in <a href="#RFC4119">PIDF-LO</a> <cite title="NONE">[RFC4119]</cite> documents.  </p>
<p id="rfc.section.3.2.p.2">The PIDF-LO can contain uncertainty, but does not include an indication of confidence.  <a href="#RFC5491">[RFC5491]</a> defines a fixed value of 95%.  Similarly, the PIDF-LO format does not provide an indication of the shape of the PDF.  <a href="#confidence">Section 4</a> defines elements to convey this information in PIDF-LO.  </p>
<p id="rfc.section.3.2.p.3">Absence of uncertainty information in a PIDF-LO document does not indicate that there is no uncertainty in the location estimate.  Uncertainty might not have been calculated for the estimate, or it may be withheld for privacy purposes.  </p>
<p id="rfc.section.3.2.p.4">If the Point shape is used, confidence and uncertainty are unknown; a receiver can either assume a confidence of 0% or infinite uncertainty.  The same principle applies on the altitude axis for two-dimension shapes like the Circle.  </p>
<h1 id="rfc.section.3.3"><a href="#rfc.section.3.3">3.3.</a> Uncertainty and Confidence for Civic Addresses</h1>
<p id="rfc.section.3.3.p.1">Automatically determined <a href="#RFC5139">civic addresses</a> <cite title="NONE">[RFC5139]</cite> inherently include uncertainty, based on the area of the most precise element that is specified.  In this case, uncertainty is effectively described by the presence or absence of elements -- elements that are not present are deemed to be uncertain.  </p>
<p id="rfc.section.3.3.p.2">To apply the concept of uncertainty to civic addresses, it is helpful to unify the conceptual models of civic address with geodetic location information.  This is particularly useful when considering civic addresses that are determined using reverse geocoding (that is, the process of translating geodetic information into civic addresses).  </p>
<p id="rfc.section.3.3.p.3">In the unified view, a civic address defines a series of (sometimes non-orthogonal) spatial partitions.  The first is the implicit partition that identifies the surface of the earth and the space near the surface.  The second is the country.  Each label that is included in a civic address provides information about a different set of spatial partitions.  Some partitions require slight adjustments from a standard interpretation: for instance, a road includes all properties that adjoin the street.  Each label might need to be interpreted with other values to provide context.  </p>
<p id="rfc.section.3.3.p.4">As a value at each level is interpreted, one or more spatial partitions at that level are selected, and all other partitions of that type are excluded.  For non-orthogonal partitions, only the portion of the partition that fits within the existing space is selected.  This is what distinguishes King Street in Sydney from King Street in Melbourne.  Each defined element selects a partition of space.  The resulting location is the intersection of all selected spaces.  </p>
<p id="rfc.section.3.3.p.5">The resulting spatial partition can be considered as a region of uncertainty.  </p>

<dl>
  <dt>Note:</dt>
  <dd style="margin-left: 8">This view is a potential perspective on the process of geo-coding - the translation of a civic address to a geodetic location.  </dd>
</dl>

<p> </p>
<p id="rfc.section.3.3.p.6">Uncertainty in civic addresses can be increased by removing elements.  This does not increase confidence unless additional information is used.  Similarly, arbitrarily increasing uncertainty in a geodetic location does not increase confidence.  </p>
<h1 id="rfc.section.3.4"><a href="#rfc.section.3.4">3.4.</a> DHCP Location Configuration Information and Uncertainty</h1>
<p id="rfc.section.3.4.p.1">Location information is often measured in two or three dimensions; expressions of uncertainty in one dimension only are rare.  The "resolution" parameters in <a href="#RFC6225">[RFC6225]</a> provide an indication of how many bits of a number are valid, which could be interpreted as an expression of uncertainty in one dimension.  </p>
<p><a href="#RFC6225">[RFC6225]</a> defines a means for representing uncertainty, but a value for confidence is not specified.  A default value of 95% confidence is assumed for the combination of the uncertainty on each axis.  This is consistent with the transformation of those forms into the uncertainty representations from <a href="#RFC5491">[RFC5491]</a>.  That is, the confidence of the resultant rectangular polygon or prism is assumed to be 95%.  </p>
<h1 id="rfc.section.4"><a href="#rfc.section.4">4.</a> <a href="#confidence" id="confidence">Representation of Confidence in PIDF-LO</a></h1>
<p id="rfc.section.4.p.1">On the whole, a fixed definition for confidence is preferable.  Primarily because it ensures consistency between implementations.  Location generators that are aware of this constraint can generate location information at the required confidence.  Location recipients are able to make sensible assumptions about the quality of the information that they receive.  </p>
<p id="rfc.section.4.p.2">In some circumstances - particularly with pre-existing systems - location generators might unable to provide location information with consistent confidence.  Existing systems sometimes specify confidence at 38%, 67% or 90%.  Existing forms of expressing location information, such as that defined in <a href="#TS-3GPP-23_032">[TS-3GPP-23_032]</a>, contain elements that express the confidence in the result.  </p>
<p id="rfc.section.4.p.3">The addition of a confidence element provides information that was previously unavailable to recipients of location information.  Without this information, a location server or generator that has access to location information with a confidence lower than 95% has two options: </p>

<ul>
  <li>The location server can scale regions of uncertainty in an attempt to acheive 95% confidence.  This scaling process significantly degrades the quality of the information, because the location server might not have the necessary information to scale appropriately; the location server is forced to make assumptions that are likely to result in either an overly conservative estimate with high uncertainty or a overestimate of confidence.  </li>
  <li>The location server can ignore the confidence entirely, which results in giving the recipient a false impression of its quality.  </li>
</ul>

<p> Both of these choices degrade the quality of the information provided.  </p>
<p id="rfc.section.4.p.4">The addition of a confidence element avoids this problem entirely if a location recipient supports and understands the element.  A recipient that does not understand - and hence ignores - the confidence element is in no worse a position than if the location server ignored confidence.  </p>
<h1 id="rfc.section.4.1"><a href="#rfc.section.4.1">4.1.</a> <a href="#conf" id="conf">The "confidence" Element</a></h1>
<p id="rfc.section.4.1.p.1">The confidence element MAY be added to the <samp>location-info</samp> element of the <a href="#RFC4119">Presence Information Data Format - Location Object (PIDF-LO)</a> <cite title="NONE">[RFC4119]</cite> document.  This element expresses the confidence in the associated location information as a percentage.  A special <samp>unknown</samp> value is reserved to indicate that confidence is supported, but not known to the Location Generator.  </p>
<p id="rfc.section.4.1.p.2">The confidence element optionally includes an attribute that indicates the shape of the probability density function (PDF) of the associated region of uncertainty.  Three values are possible: unknown, normal and rectangular.  </p>
<p id="rfc.section.4.1.p.3">Indicating a particular PDF only indicates that the distribution approximately fits the given shape based on the methods used to generate the location information.  The PDF is normal if there are a large number of small, independent sources of error; rectangular if all points within the area have roughly equal probability of being the actual location of the Target; otherwise, the PDF MUST either be set to unknown or omitted.  </p>
<p id="rfc.section.4.1.p.4">If a PIDF-LO does not include the confidence element, the confidence of the location estimate is 95%, as defined in <a href="#RFC5491">[RFC5491]</a>.  </p>
<p id="rfc.section.4.1.p.5">A Point shape does not have uncertainty (or it has infinite uncertainty), so confidence is meaningless for a point; therefore, this element MUST be omitted if only a point is provided.  </p>
<h1 id="rfc.section.4.2"><a href="#rfc.section.4.2">4.2.</a> Generating Locations with Confidence</h1>
<p id="rfc.section.4.2.p.1">Location generators SHOULD attempt to ensure that confidence is equal in each dimension when generating location information.  This restriction, while not always practical, allows for more accurate scaling, if scaling is necessary.  </p>
<p id="rfc.section.4.2.p.2">A confidence element MUST be included with all location information that includes uncertainty (that is, all forms other than a point).  A special <samp>unknown</samp> MAY be used if confidence is not known.  </p>
<h1 id="rfc.section.4.3"><a href="#rfc.section.4.3">4.3.</a> Consuming and Presenting Confidence</h1>
<p id="rfc.section.4.3.p.1">The inclusion of confidence that is anything other than 95% presents a potentially difficult usability problem for applications that use location information.  Effectively communicating the probability that a location is incorrect to a user can be difficult.  </p>
<p id="rfc.section.4.3.p.2">It is inadvisable to simply display locations of any confidence, or to display confidence in a separate or non-obvious fashion.  If locations with different confidence levels are displayed such that the distinction is subtle or easy to overlook - such as using fine graduations of color or transparency for graphical uncertainty regions, or displaying uncertainty graphically, but providing confidence as supplementary text - a user could fail to notice a difference in the quality of the location information that might be significant.  </p>
<p id="rfc.section.4.3.p.3">Depending on the circumstances, different ways of handling confidence might be appropriate.  <a href="#manipulation">Section 5</a> describes techniques that could be appropriate for consumers that use automated processing.  </p>
<p id="rfc.section.4.3.p.4">Providing that the full implications of any choice for the application are understood, some amount of automated processing could be appropriate.  In a simple example, applications could choose to discard or suppress the display of location information if confidence does not meet a pre-determined threshold.  </p>
<p id="rfc.section.4.3.p.5">In settings where there is an opportunity for user training, some of these problems might be mitigated by defining different operational procedures for handling location information at different confidence levels.  </p>
<h1 id="rfc.section.5"><a href="#rfc.section.5">5.</a> <a href="#manipulation" id="manipulation">Manipulation of Uncertainty</a></h1>
<p id="rfc.section.5.p.1">This section deals with manipulation of location information that contains uncertainty.  </p>
<p id="rfc.section.5.p.2">The following rules generally apply when manipulating location information: </p>

<ul>
  <li>Where calculations are performed on coordinate information, these should be performed in Cartesian space and the results converted back to latitude, longitude and altitude.  A method for converting to and from Cartesian coordinates is included in <a href="#ecef2geo">Appendix A</a>.  <ul class="empty"><li>While some approximation methods are useful in simplifying calculations, treating latitude and longitude as Cartesian axes is never advisable.  The two axes are not orthogonal.  Errors can arise from the curvature of the earth and from the convergence of longitude lines.  </li></ul><p> </p></li>
  <li>Normal rounding rules do not apply when rounding uncertainty.  When rounding, the region of uncertainty always increases (that is, errors are rounded up) and confidence is always rounded down (see <a href="#NIST.TN1297">[NIST.TN1297]</a>).  This means that any manipulation of uncertainty is a non-reversible operation; each manipulation can result in the loss of some information.  </li>
</ul>

<p> </p>
<h1 id="rfc.section.5.1"><a href="#rfc.section.5.1">5.1.</a> <a href="#nominal" id="nominal">Reduction of a Location Estimate to a Point</a></h1>
<p id="rfc.section.5.1.p.1">Manipulating location estimates that include uncertainty information requires additional complexity in systems.  In some cases, systems only operate on definitive values, that is, a single point.  </p>
<p id="rfc.section.5.1.p.2">This section describes algorithms for reducing location estimates to a simple form without uncertainty information.  Having a consistent means for reducing location estimates allows for interaction between applications that are able to use uncertainty information and those that cannot.  </p>
<p/>

<dl>
  <dt>Note:</dt>
  <dd style="margin-left: 8">Reduction of a location estimate to a point constitutes a reduction in information.  Removing uncertainty information can degrade results in some applications.  Also, there is a natural tendency to misinterpret a point location as representing a location without uncertainty.  This could lead to more serious errors.  Therefore, these algorithms should only be applied where necessary.  </dd>
</dl>

<p> </p>
<p id="rfc.section.5.1.p.4">Several different approaches can be taken when reducing a location estimate to a point.  Different methods each make a set of assumptions about the properties of the PDF and the selected point; no one method is more "correct" than any other.  For any given region of uncertainty, selecting an arbitrary point within the area could be considered valid; however, given the aforementioned problems with point locations, a more rigorous approach is appropriate.  </p>
<p id="rfc.section.5.1.p.5">Given a result with a known distribution, selecting the point within the area that has the highest probability is a more rigorous method.  Alternatively, a point could be selected that minimizes the overall error; that is, it minimizes the expected value of the difference between the selected point and the "true" value.  </p>
<p id="rfc.section.5.1.p.6">If a rectangular distribution is assumed, the centroid of the area or volume minimizes the overall error.  Minimizing the error for a normal distribution is mathematically complex.  Therefore, this document opts to select the centroid of the region of uncertainty when selecting a point.  </p>
<h1 id="rfc.section.5.1.1"><a href="#rfc.section.5.1.1">5.1.1.</a> <a href="#centroid" id="centroid">Centroid Calculation</a></h1>
<p id="rfc.section.5.1.1.p.1">For regular shapes, such as Circle, Sphere, Ellipse and Ellipsoid, this approach equates to the center point of the region.  For regions of uncertainty that are expressed as regular Polygons and Prisms the center point is also the most appropriate selection.  </p>
<p id="rfc.section.5.1.1.p.2">For the Arc-Band shape and non-regular Polygons and Prisms, selecting the centroid of the area or volume minimizes the overall error.  This assumes that the PDF is rectangular.  </p>

<dl>
  <dt>Note:</dt>
  <dd style="margin-left: 8">The centroid of a concave Polygon or Arc-Band shape is not necessarily within the region of uncertainty.  </dd>
</dl>

<p> </p>
<h1 id="rfc.section.5.1.1.1"><a href="#rfc.section.5.1.1.1">5.1.1.1.</a> Arc-Band Centroid</h1>
<p id="rfc.section.5.1.1.1.p.1">The centroid of the Arc-Band shape is found along a line that bisects the arc.  The centroid can be found at the following distance from the starting point of the arc-band (assuming an arc-band with an inner radius of <samp>r</samp>, outer radius <samp>R</samp>, start angle <samp>a</samp>, and opening angle <samp>o</samp>): <samp>a&#160;+&#160;(o/2)</samp>.  </p>

<ul class="empty">
  <li>d = 4 * sin(o/2) * (R*R + R*r + r*r) / (3*o*(R + r)) </li>
</ul>

<p> This point can be found along the line that bisects the arc; that is, the line at an angle of </p>
<h1 id="rfc.section.5.1.1.2"><a href="#rfc.section.5.1.1.2">5.1.1.2.</a> <a href="#centroid-polygon" id="centroid-polygon">Polygon Centroid</a></h1>
<p id="rfc.section.5.1.1.2.p.1">Calculating a centroid for the Polygon and Prism shapes is more complex.  Polygons that are specified using geodetic coordinates are not necessarily coplanar.  For Polygons that are specified without an altitude, choose a value for altitude before attempting this process; an altitude of 0 is acceptable.  </p>

<ul class="empty">
  <li>The method described in this section is simplified by assuming that the surface of the earth is locally flat.  This method degrades as polygons become larger; see <a href="#GeoShape">[GeoShape]</a> for recommendations on polygon size.  </li>
</ul>

<p> </p>
<p id="rfc.section.5.1.1.2.p.2">The polygon is translated to a new coordinate system that has an x-y plane roughly parallel to the polygon.  This enables the elimination of z-axis values and calculating a centroid can be done using only x and y coordinates.  This requires that the upward normal for the polygon is known.  </p>
<p id="rfc.section.5.1.1.2.p.3">To translate the polygon coordinates, apply the process described in <a href="#polygonupnormal">Appendix B</a> to find the normal vector <samp>N&#160;=&#160;[Nx,Ny,Nz]</samp>.  This value should be made a unit vector to ensure that the transformation matrix is a special orthogonal matrix.  From this vector, select two vectors that are perpendicular to this vector and combine these into a transformation matrix.  </p>
<p id="rfc.section.5.1.1.2.p.4">If <samp>Nx</samp> and <samp>Ny</samp> are non-zero, the matrices in <a href="#transformmatrices">Figure 3</a> can be used, given <samp>p&#160;=&#160;sqrt(Nx^2&#160;+&#160;Ny^2)</samp>.  More transformations are provided later in this section for cases where <samp>Nx</samp> or <samp>Ny</samp> are zero.  </p>
<div id="rfc.figure.3"/>
<div id="transformmatrices"/>
<pre>
       [   -Ny/p     Nx/p     0  ]         [ -Ny/p  -Nx*Nz/p  Nx ]
   T = [ -Nx*Nz/p  -Ny*Nz/p   p  ]    T' = [  Nx/p  -Ny*Nz/p  Ny ]
       [    Nx        Ny      Nz ]         [   0      p       Nz ]
              (Transform)                    (Reverse Transform)
</pre>
<p class="figure">Figure 3: Recommended Transformation Matrices</p>
<p id="rfc.section.5.1.1.2.p.5">To apply a transform to each point in the polygon, form a matrix from the ECEF coordinates and use matrix multiplication to determine the translated coordinates.  </p>
<div id="rfc.figure.4"/>
<div id="transform"/>
<pre>
   [   -Ny/p     Nx/p     0  ]   [ x[1]  x[2]  x[3]  ...  x[n] ]
   [ -Nx*Nz/p  -Ny*Nz/p   p  ] * [ y[1]  y[2]  y[3]  ...  y[n] ]
   [    Nx        Ny      Nz ]   [ z[1]  z[2]  z[3]  ...  z[n] ]

       [ x'[1]  x'[2]  x'[3]  ... x'[n] ]
     = [ y'[1]  y'[2]  y'[3]  ... y'[n] ]
       [ z'[1]  z'[2]  z'[3]  ... z'[n] ]
</pre>
<p class="figure">Figure 4: Transformation</p>
<p id="rfc.section.5.1.1.2.p.6">Alternatively, direct multiplication can be used to achieve the same result: </p>

<ul class="empty">
  <li>x'[i] = -Ny * x[i] / p + Nx * y[i] / p </li>
  <li>y'[i] = -Nx * Nz * x[i] / p - Ny * Nz * y[i] / p + p * z[i] </li>
  <li>z'[i] = Nx * x[i] + Ny * y[i] + Nz * z[i] </li>
</ul>

<p> </p>
<p id="rfc.section.5.1.1.2.p.7">The first and second rows of this matrix (<samp>x'</samp> and <samp>y'</samp>) contain the values that are used to calculate the centroid of the polygon.  To find the centroid of this polygon, first find the area using: <samp>x'[0]&#160;==&#160;x'[n]</samp> and <samp>x'[n+1]&#160;==&#160;x'[1]</samp>.  Based on the area, the centroid along each axis can be determined by: </p>

<ul class="empty">
  <li>A = sum from i=1..n of (x'[i]*y'[i+1]-x'[i+1]*y'[i]) / 2 </li>
</ul>

<p> For these formulae, treat each set of coordinates as circular, that is </p>

<ul class="empty">
  <li>Cx' = sum (x'[i]+x'[i+1]) * (x'[i]*y'[i+1]-x'[i+1]*y'[i]) / (6*A) </li>
  <li>Cy' = sum (y'[i]+y'[i+1]) * (x'[i]*y'[i+1]-x'[i+1]*y'[i]) / (6*A) </li>
</ul>

<p> </p>

<dl>
  <dt>Note:</dt>
  <dd style="margin-left: 8">The formula for the area of a polygon will return a negative value if the polygon is specified in clockwise direction.  This can be used to determine the orientation of the polygon.  </dd>
</dl>

<p> </p>
<p id="rfc.section.5.1.1.2.p.8">The third row contains a distance from a plane parallel to the polygon.  If the polygon is coplanar, then the values for <samp>z'</samp> are identical; however, the constraints recommended in <a href="#RFC5491">[RFC5491]</a> mean that this is rarely the case.  To determine <samp>Cz'</samp>, average these values: </p>

<ul class="empty">
  <li>Cz' = sum z'[i] / n </li>
</ul>

<p> </p>
<p id="rfc.section.5.1.1.2.p.9">Once the centroid is known in the transformed coordinates, these can be transformed back to the original coordinate system.  The reverse transformation is shown in <a href="#reversetransform">Figure 5</a>.  </p>
<div id="rfc.figure.5"/>
<div id="reversetransform"/>
<pre>
   [ -Ny/p  -Nx*Nz/p  Nx ]     [       Cx'        ]   [ Cx ]
   [  Nx/p  -Ny*Nz/p  Ny ]  *  [       Cy'        ] = [ Cy ]
   [   0        p     Nz ]     [ sum of z'[i] / n ]   [ Cz ]
</pre>
<p class="figure">Figure 5: Reverse Transformation</p>
<p id="rfc.section.5.1.1.2.p.10">The reverse transformation can be applied directly as follows: </p>

<ul class="empty">
  <li>Cx = -Ny * Cx' / p - Nx * Nz * Cy' / p + Nx * Cz' </li>
  <li>Cy = Nx * Cx' / p - Ny * Nz * Cy' / p + Ny * Cz' </li>
  <li>Cz = p * Cy' + Nz * Cz' </li>
</ul>

<p> </p>
<p id="rfc.section.5.1.1.2.p.11">The ECEF value <samp>[Cx,Cy,Cz]</samp> can then be converted back to geodetic coordinates.  Given a polygon that is defined with no altitude or equal altitudes for each point, the altitude of the result can either be ignored or reset after converting back to a geodetic value.  </p>
<p id="rfc.section.5.1.1.2.p.12">The centroid of the Prism shape is found by finding the centroid of the base polygon and raising the point by half the height of the prism.  This can be added to altitude of the final result; alternatively, this can be added to <samp>Cz'</samp>, which ensures that negative height is correctly applied to polygons that are defined in a "clockwise" direction.  </p>
<p id="rfc.section.5.1.1.2.p.13">The recommended transforms only apply if <samp>Nx</samp> and <samp>Ny</samp> are non-zero.  If the normal vector is <samp>[0,0,1]</samp> (that is, along the z-axis), then no transform is necessary.  Similarly, if the normal vector is <samp>[0,1,0]</samp> or <samp>[1,0,0]</samp>, avoid the transformation and use the x and z coordinates or y and z coordinates (respectively) in the centroid calculation phase.  If either <samp>Nx</samp> or <samp>Ny</samp> are zero, the alternative transform matrices in <a href="#alternativetransform">Figure 6</a> can be used.  The reverse transform is the transpose of this matrix.  </p>
<div id="rfc.figure.6"/>
<div id="alternativetransform"/>
<pre>
 if Nx == 0:                              | if Ny == 0:
     [ 0  -Nz  Ny ]       [  0   1  0  ]  |            [ -Nz  0  Nx ]
 T = [ 1   0   0  ]  T' = [ -Nz  0  Ny ]  |   T = T' = [  0   1  0  ]
     [ 0   Ny  Nz ]       [  Ny  0  Nz ]  |            [  Nx  0  Nz ]
</pre>
<p class="figure">Figure 6: Alternative Transformation Matrices</p>
<h1 id="rfc.section.5.2"><a href="#rfc.section.5.2">5.2.</a> <a href="#circle" id="circle">Conversion to Circle or Sphere</a></h1>
<p id="rfc.section.5.2.p.1">The Circle or Sphere are simple shapes that suit a range of applications.  A circle or sphere contains fewer units of data to manipulate, which simplifies operations on location estimates.  </p>
<p id="rfc.section.5.2.p.2">The simplest method for converting a location estimate to a Circle or Sphere shape is to determine the centroid and then find the longest distance to any point in the region of uncertainty to that point.  This distance can be determined based on the shape type: </p>

<dl>
  <dt>Circle/Sphere:</dt>
  <dd style="margin-left: 8">No conversion necessary.  </dd>
  <dt>Ellipse/Ellipsoid:</dt>
  <dd style="margin-left: 8">The greater of either semi-major axis or altitude uncertainty.  </dd>
  <dt>Polygon/Prism:</dt>
  <dd style="margin-left: 8">The distance to the furthest vertex of the polygon (for a Prism, it is only necessary to check points on the base).  </dd>
  <dt>Arc-Band:</dt>
  <dd style="margin-left: 8">The furthest length from the centroid to the points where the inner and outer arc end.  This distance can be calculated by finding the larger of the two following formulae: <ul class="empty"><li>X = sqrt( d*d + R*R - 2*d*R*cos(o/2) ) </li><li>x = sqrt( d*d + r*r - 2*d*r*cos(o/2) ) </li></ul><p> </p></dd>
</dl>

<p> </p>
<p id="rfc.section.5.2.p.3">Once the Circle or Sphere shape is found, the associated confidence can be increased if the result is known to follow a normal distribution.  However, this is a complicated process and provides limited benefit.  In many cases it also violates the constraint that confidence in each dimension be the same.  Confidence should be unchanged when performing this conversion.  </p>
<p id="rfc.section.5.2.p.4">Two dimensional shapes are converted to a Circle; three dimensional shapes are converted to a Sphere.  </p>
<h1 id="rfc.section.5.3"><a href="#rfc.section.5.3">5.3.</a> Three-Dimensional to Two-Dimensional Conversion</h1>
<p id="rfc.section.5.3.p.1">A three-dimensional shape can be easily converted to a two-dimensional shape by removing the altitude component.  A sphere becomes a circle; a prism becomes a polygon; an ellipsoid becomes an ellipse.  Each conversion is simple, requiring only the removal of those elements relating to altitude.  </p>
<p id="rfc.section.5.3.p.2">The altitude is unspecified for a two-dimensional shape and therefore has unlimited uncertainty along the vertical axis.  The confidence for the two-dimensional shape is thus higher than the three-dimensional shape.  Assuming equal confidence on each axis, the confidence of the circle can be increased using the following approximate formula: <samp>C[2d]</samp> is the confidence of the two-dimensional shape and <samp>C[3d]</samp> is the confidence of the three-dimensional shape.  For example, a Sphere with a confidence of 95% can be simplified to a Circle of equal radius with confidence of 96.6%.  </p>

<ul class="empty">
  <li>C[2d] &gt;= C[3d] ^ (2/3) </li>
</ul>

<p> </p>
<h1 id="rfc.section.5.4"><a href="#rfc.section.5.4">5.4.</a> <a href="#scaling" id="scaling">Increasing and Decreasing Uncertainty and Confidence</a></h1>
<p id="rfc.section.5.4.p.1">The combination of uncertainty and confidence provide a great deal of information about the nature of the data that is being measured.  If uncertainty, confidence and PDF are known, certain information can be extrapolated.  In particular, the uncertainty can be scaled to meet a desired confidence or the confidence for a particular region of uncertainty can be found.  </p>
<p id="rfc.section.5.4.p.2">In general, confidence decreases as the region of uncertainty decreases in size and confidence increases as the region of uncertainty increases in size.  However, this depends on the PDF; expanding the region of uncertainty for a rectangular distribution has no effect on confidence without additional information.  If the region of uncertainty is increased during the process of obfuscation (see <a href="#I-D.thomson-geopriv-location-obscuring">[I-D.thomson-geopriv-location-obscuring]</a>), then the confidence cannot be increased.  </p>
<p id="rfc.section.5.4.p.3">A region of uncertainty that is reduced in size always has a lower confidence.  </p>
<p id="rfc.section.5.4.p.4">A region of uncertainty that has an unknown PDF shape cannot be reduced in size reliably.  The region of uncertainty can be expanded, but only if confidence is not increased.  </p>
<p id="rfc.section.5.4.p.5">This section makes the simplifying assumption that location information is symmetrically and evenly distributed in each dimension.  This is not necessarily true in practice.  If better information is available, alternative methods might produce better results.  </p>
<h1 id="rfc.section.5.4.1"><a href="#rfc.section.5.4.1">5.4.1.</a> <a href="#scale-rectangular" id="scale-rectangular">Rectangular Distributions</a></h1>
<p id="rfc.section.5.4.1.p.1">Uncertainty that follows a rectangular distribution can only be decreased in size.  Increasing uncertainty has no value, since it has no effect on confidence.  Since the PDF is constant over the region of uncertainty, the resulting confidence is determined by the following formula: <samp>Uo</samp> and <samp>Ur</samp> are the sizes of the original and reduced regions of uncertainty (either the area or the volume of the region); <samp>Co</samp> and <samp>Cb</samp> are the confidence values associated with each region.  </p>

<ul class="empty">
  <li>Cr = Co * Ur / Uo </li>
</ul>

<p> Where </p>
<p id="rfc.section.5.4.1.p.2">Information is lost by decreasing the region of uncertainty for a rectangular distribution.  Once reduced in size, the uncertainty region cannot subsequently be increased in size.  </p>
<h1 id="rfc.section.5.4.2"><a href="#rfc.section.5.4.2">5.4.2.</a> <a href="#scale-normal" id="scale-normal">Normal Distributions</a></h1>
<p id="rfc.section.5.4.2.p.1">Uncertainty and confidence can be both increased and decreased for a normal distribution.  This calculation depends on the number of dimensions of the uncertainty region.  </p>
<p id="rfc.section.5.4.2.p.2">For a normal distribution, uncertainty and confidence are related to the standard deviation of the function.  The following function defines the relationship between standard deviation, uncertainty, and confidence along a single axis: <samp>S[x]</samp> is the standard deviation, <samp>U[x]</samp> is the uncertainty, and <samp>C[x]</samp> is the confidence along a single axis.  <samp>erfinv</samp> is the inverse error function.  </p>

<ul class="empty">
  <li>S[x] = U[x] / ( sqrt(2) * erfinv(C[x]) ) </li>
</ul>

<p> Where </p>
<p id="rfc.section.5.4.2.p.3">Scaling a normal distribution in two dimensions requires several assumptions.  Firstly, it is assumed that the distribution along each axis is independent.  Secondly, the confidence for each axis is assumed to be the same.  Therefore, the confidence along each axis can be assumed to be: <samp>C[x]</samp> is the confidence along a single axis and <samp>Co</samp> is the overall confidence and <samp>n</samp> is the number of dimensions in the uncertainty.  </p>

<ul class="empty">
  <li>C[x] = Co ^ (1/n) </li>
</ul>

<p> Where </p>
<p id="rfc.section.5.4.2.p.4">Therefore, to find the uncertainty for each axis at a desired confidence, <samp>Cd</samp>, apply the following formula: </p>

<ul class="empty">
  <li>Ud[x] &lt;= U[x] * (erfinv(Cd ^ (1/n)) / erfinv(Co ^ (1/n))) </li>
</ul>

<p> For regular shapes, this formula can be applied as a scaling factor in each dimension to reach a required confidence.  </p>
<h1 id="rfc.section.5.5"><a href="#rfc.section.5.5">5.5.</a> <a href="#inarea" id="inarea">Determining Whether a Location is Within a Given Region</a></h1>
<p id="rfc.section.5.5.p.1">A number of applications require that a judgment be made about whether a Target is within a given region of interest.  Given a location estimate with uncertainty, this judgment can be difficult.  A location estimate represents a probability distribution, and the true location of the Target cannot be definitively known.  Therefore, the judgment relies on determining the probability that the Target is within the region.  </p>
<p id="rfc.section.5.5.p.2">The probability that the Target is within a particular region is found by integrating the PDF over the region.  For a normal distribution, there are no analytical methods that can be used to determine the integral of the two or three dimensional PDF over an arbitrary region.  The complexity of numerical methods is also too great to be useful in many applications; for example, finding the integral of the PDF in two or three dimensions across the overlap between the uncertainty region and the target region.  If the PDF is unknown, no determination can be made without a simplifying assumption.  </p>
<p id="rfc.section.5.5.p.3">When judging whether a location is within a given region, this document assumes that uncertainties are rectangular.  This introduces errors, but simplifies the calculations significantly.  Prior to applying this assumption, confidence should be scaled to 95%.  </p>

<dl>
  <dt>Note:</dt>
  <dd style="margin-left: 8">The selection of confidence has a significant impact on the final result.  Only use a different confidence if an uncertainty value for 95% confidence cannot be found.  </dd>
</dl>

<p> </p>
<p id="rfc.section.5.5.p.4">Given the assumption of a rectangular distribution, the probability that a Target is found within a given region is found by first finding the area (or volume) of overlap between the uncertainty region and the region of interest.  This is multiplied by the confidence of the location estimate to determine the probability.  <a href="#overlap">Figure 7</a> shows an example of finding the area of overlap between the region of uncertainty and the region of interest.  </p>
<div id="rfc.figure.7"/>
<div id="overlap"/>
<pre>
                 _.-""""-._
               .'          `.    _ Region of
              /              \  /  Uncertainty
           ..+-"""--..        |
        .-'  | :::::: `-.     |
      ,'     | :: Ao ::: `.   |
     /        \ :::::::::: \ /
    /          `._ :::::: _.X
   |              `-....-'   |
   |                         |
   |                         |
    \                       /
     `.                   .'  \_ Region of
       `._             _.'       Interest
          `--..___..--'
</pre>
<p class="figure">Figure 7: Area of Overlap Between Two Circular Regions</p>
<p id="rfc.section.5.5.p.5">Once the area of overlap, <samp>Ao</samp>, is known, the probability that the Target is within the region of interest, <samp>Pi</samp>, is: <samp>Au</samp> and the confidence is <samp>Co</samp>.  </p>

<ul class="empty">
  <li>Pi = Co * Ao / Au </li>
</ul>

<p> Given that the area of the region of uncertainty is </p>
<p id="rfc.section.5.5.p.6">This probability is often input to a decision process that has a limited set of outcomes; therefore, a threshold value needs to be selected.  Depending on the application, different threshold probabilities might be selected.  In the absence of specific recommendations, this document suggests that the probability be greater than 50% before a decision is made.  If the decision process selects between two or more regions, as is required by <a href="#RFC5222">[RFC5222]</a>, then the region with the highest probability can be selected.  </p>
<h1 id="rfc.section.5.5.1"><a href="#rfc.section.5.5.1">5.5.1.</a> Determining the Area of Overlap for Two Circles</h1>
<p id="rfc.section.5.5.1.p.1">Determining the area of overlap between two arbitrary shapes is a non-trivial process.  Reducing areas to circles (see <a href="#circle">Section 5.2</a>) enables the application of the following process.  </p>
<p id="rfc.section.5.5.1.p.2">Given the radius of the first circle <samp>r</samp>, the radius of the second circle <samp>R</samp> and the distance between their center points <samp>d</samp>, the following set of formulas provide the area of overlap <samp>Ao</samp>.  <samp>d</samp> can be determined by converting the center points to Cartesian coordinates and calculating the distance between the two center points: </p>

<ul>
  <li>If the circles don't overlap, that is <samp>d&#160;&gt;=&#160;r+R</samp>, <samp>Ao</samp> is zero.  </li>
  <li>If one of the two circles is entirely within the other, that is <samp>d&#160;&lt;=&#160;|r-R|</samp>, the area of overlap is the area of the smaller circle.  </li>
  <li>Otherwise, if the circles partially overlap, that is <samp>d&#160;&lt;&#160;r+R</samp> and <samp>d&#160;&gt;&#160;|r-R|</samp>, find <samp>Ao</samp> using: <ul class="empty"><li>a = (r^2 - R^2 + d^2)/(2*d) </li><li>Ao = r^2*acos(a/r) + R^2*acos((d - a)/R) - d*sqrt(r^2 - a^2) </li></ul><p> </p></li>
</ul>

<p> A value for </p>

<ul class="empty">
  <li>d = sqrt((x1-x2)^2 + (y1-y2)^2 + (z1-z2)^2) </li>
</ul>

<p> </p>
<h1 id="rfc.section.5.5.2"><a href="#rfc.section.5.5.2">5.5.2.</a> Determining the Area of Overlap for Two Polygons</h1>
<p id="rfc.section.5.5.2.p.1">A calculation of overlap based on polygons can give better results than the circle-based method.  However, efficient calculation of overlapping area is non-trivial.  Algorithms such as <a href="#Vatti92">Vatti's clipping algorithm</a> <cite title="NONE">[Vatti92]</cite> can be used.  </p>
<p id="rfc.section.5.5.2.p.2">For large polygonal areas, it might be that geodesic interpolation is used.  In these cases, altitude is also frequently omitted in describing the polygon.  For such shapes, a planar projection can still give a good approximation of the area of overlap if the larger area polygon is projected onto the local tangent plane of the smaller.  This is only possible if the only area of interest is that contained within the smaller polygon.  Where the entire area of the larger polygon is of interest, geodesic interpolation is necessary.  </p>
<h1 id="rfc.section.6"><a href="#rfc.section.6">6.</a> <a href="#examples" id="examples">Examples</a></h1>
<p id="rfc.section.6.p.1">This section presents some examples of how to apply the methods described in <a href="#manipulation">Section 5</a>.  </p>
<h1 id="rfc.section.6.1"><a href="#rfc.section.6.1">6.1.</a> Reduction to a Point or Circle</h1>
<p id="rfc.section.6.1.p.1">Alice receives a location estimate from her LIS that contains an ellipsoidal region of uncertainty.  This information is provided at 19% confidence with a normal PDF.  A PIDF-LO extract for this information is shown in <a href="#ex-ellipse">Figure 8</a>.  </p>
<div id="rfc.figure.8"/>
<div id="ex-ellipse"/>
<pre>
  &lt;gp:geopriv&gt;
    &lt;gp:location-info&gt;
      &lt;gs:Ellipsoid srsName="urn:ogc:def:crs:EPSG::4979"&gt;
        &lt;gml:pos&gt;-34.407242 150.882518 34&lt;/gml:pos&gt;
        &lt;gs:semiMajorAxis uom="urn:ogc:def:uom:EPSG::9001"&gt;
          7.7156
        &lt;/gs:semiMajorAxis&gt;
        &lt;gs:semiMinorAxis uom="urn:ogc:def:uom:EPSG::9001"&gt;
          3.31
        &lt;/gs:semiMinorAxis&gt;
        &lt;gs:verticalAxis uom="urn:ogc:def:uom:EPSG::9001"&gt;
          28.7
        &lt;/gs:verticalAxis&gt;
        &lt;gs:orientation uom="urn:ogc:def:uom:EPSG::9102"&gt;
          43
        &lt;/gs:orientation&gt;
      &lt;/gs:Ellipsoid&gt;
    &lt;/gp:location-info&gt;
    &lt;gp:usage-rules/&gt;
  &lt;/gp:geopriv&gt;
</pre>
<p class="figure">Figure 8</p>
<p id="rfc.section.6.1.p.2">This information can be reduced to a point simply by extracting the center point, that is [-34.407242,&#160;150.882518,&#160;34].  </p>
<p id="rfc.section.6.1.p.3">If some limited uncertainty were required, the estimate could be converted into a circle or sphere.  To convert to a sphere, the radius is the largest of the semi-major, semi-minor and vertical axes; in this case, 28.7 meters.  </p>
<p id="rfc.section.6.1.p.4">However, if only a circle is required, the altitude can be dropped as can the altitude uncertainty (the vertical axis of the ellipsoid), resulting in a circle at [-34.407242,&#160;150.882518] of radius 7.7156 meters.  </p>
<p id="rfc.section.6.1.p.5">Bob receives a location estimate with a Polygon shape.  This information is shown in <a href="#ex-polygon">Figure 9</a>.  </p>
<div id="rfc.figure.9"/>
<div id="ex-polygon"/>
<pre>
  &lt;gml:Polygon srsName="urn:ogc:def:crs:EPSG::4326"&gt;
    &lt;gml:exterior&gt;
      &lt;gml:LinearRing&gt;
        &lt;gml:posList&gt;
          -33.856625 151.215906 -33.856299 151.215343
          -33.856326 151.214731 -33.857533 151.214495
          -33.857720 151.214613 -33.857369 151.215375
          -33.856625 151.215906
        &lt;/gml:posList&gt;
      &lt;/gml:LinearRing&gt;
    &lt;/gml:exterior&gt;
  &lt;/gml:Polygon&gt;
</pre>
<p class="figure">Figure 9</p>
<p id="rfc.section.6.1.p.6">To convert this to a polygon, each point is firstly assigned an altitude of zero and converted to ECEF coordinates (see <a href="#ecef2geo">Appendix A</a>).  Then a normal vector for this polygon is found (see <a href="#polygonupnormal">Appendix B</a>).  The result of each of these stages is shown in <a href="#ex-poly-convert">Figure 10</a>.  Note that the numbers shown are all rounded; no rounding is possible during this process since rounding would contribute significant errors.  </p>
<div id="rfc.figure.10"/>
<div id="ex-poly-convert"/>
<pre>
Polygon in ECEF coordinate space
   (repeated point omitted and transposed to fit):
         [ -4.6470e+06  2.5530e+06  -3.5333e+06 ]
         [ -4.6470e+06  2.5531e+06  -3.5332e+06 ]
 pecef = [ -4.6470e+06  2.5531e+06  -3.5332e+06 ]
         [ -4.6469e+06  2.5531e+06  -3.5333e+06 ]
         [ -4.6469e+06  2.5531e+06  -3.5334e+06 ]
         [ -4.6469e+06  2.5531e+06  -3.5333e+06 ]

Normal Vector: n = [ -0.72782  0.39987  -0.55712 ]

Transformation Matrix:
     [ -0.48152  -0.87643   0.00000 ]
 t = [ -0.48828   0.26827   0.83043 ]
     [ -0.72782   0.39987  -0.55712 ]

Transformed Coordinates:
          [  8.3206e+01  1.9809e+04  6.3715e+06 ]
          [  3.1107e+01  1.9845e+04  6.3715e+06 ]
 pecef' = [ -2.5528e+01  1.9842e+04  6.3715e+06 ]
          [ -4.7367e+01  1.9708e+04  6.3715e+06 ]
          [ -3.6447e+01  1.9687e+04  6.3715e+06 ]
          [  3.4068e+01  1.9726e+04  6.3715e+06 ]

Two dimensional polygon area: A = 12600 m^2
Two-dimensional polygon centroid: C' = [ 8.8184e+00  1.9775e+04 ]

Average of pecef' z coordinates: 6.3715e+06

Reverse Transformation Matrix:
      [ -0.48152  -0.48828  -0.72782 ]
 t' = [ -0.87643   0.26827   0.39987 ]
      [  0.00000   0.83043  -0.55712 ]

Polygon centroid (ECEF): C = [ -4.6470e+06  2.5531e+06  -3.5333e+06 ]
Polygon centroid (Geo): Cg = [ -33.856926  151.215102  -4.9537e-04 ]
</pre>
<p class="figure">Figure 10</p>
<p id="rfc.section.6.1.p.7">The point conversion for the polygon uses the final result, <samp>Cg</samp>, ignoring the altitude since the original shape did not include altitude.  </p>
<p id="rfc.section.6.1.p.8">To convert this to a circle, take the maximum distance in ECEF coordinates from the center point to each of the points.  This results in a radius of 99.1 meters.  Confidence is unchanged.  </p>
<h1 id="rfc.section.6.2"><a href="#rfc.section.6.2">6.2.</a> Increasing and Decreasing Confidence</h1>
<p id="rfc.section.6.2.p.1">Assuming that confidence is known to be 19% for Alice's location information.  This is a typical value for a three-dimensional ellipsoid uncertainty of normal distribution where the standard deviation is used directly for uncertainty in each dimension.  The confidence associated with Alice's location estimate is quite low for many applications.  Since the estimate is known to follow a normal distribution, the method in <a href="#scale-normal">Section 5.4.2</a> can be used.  Each axis can be scaled by: </p>

<ul class="empty">
  <li>scale = erfinv(0.95^(1/3)) / erfinv(0.19^(1/3)) = 2.9937 </li>
</ul>

<p> Ensuring that rounding always increases uncertainty, the location estimate at 95% includes a semi-major axis of 23.1, a semi-minor axis of 10 and a vertical axis of 86.  </p>
<p id="rfc.section.6.2.p.2">Bob's location estimate (from the previous example) covers an area of approximately 12600 square meters.  If the estimate follows a rectangular distribution, the region of uncertainty can be reduced in size.  Here we find the confidence that Bob is within the smaller area of the concert hall.  For the concert hall, the polygon [-33.856473,&#160;151.215257; -33.856322,&#160;151.214973; -33.856424,&#160;151.21471; -33.857248,&#160;151.214753; -33.857413,&#160;151.214941; -33.857311,&#160;151.215128] is used.  To use this new region of uncertainty, find its area using the same translation method described in <a href="#centroid-polygon">Section 5.1.1.2</a>, which produces 4566.2 square meters.  Given that the concert hall is entirely within Bob's original location estimate, the confidence associated with the smaller area is therefore 95% * 4566.2 / 12600 = 34%.  </p>
<h1 id="rfc.section.6.3"><a href="#rfc.section.6.3">6.3.</a> Matching Location Estimates to Regions of Interest</h1>
<p id="rfc.section.6.3.p.1">Suppose that a circular area is defined centered at [-33.872754,&#160;151.20683] with a radius of 1950 meters.  To determine whether Bob is found within this area - given that Bob is at [-34.407242,&#160;150.882518] with an uncertainty radius 7.7156 meters - we apply the method in <a href="#inarea">Section 5.5</a>.  Using the converted Circle shape for Bob's location, the distance between these points is found to be 1915.26 meters.  The area of overlap between Bob's location estimate and the region of interest is therefore 2209 square meters and the area of Bob's location estimate is 30853 square meters.  This gives the estimated probability that Bob is less than 1950 meters from the selected point as 67.8%.  </p>
<p id="rfc.section.6.3.p.2">Note that if 1920 meters were chosen for the distance from the selected point, the area of overlap is only 16196 square meters and the confidence is 49.8%.  Therefore, it is marginally more likely that Bob is outside the region of interest, despite the center point of his location estimate being within the region.  </p>
<h1 id="rfc.section.6.4"><a href="#rfc.section.6.4">6.4.</a> PIDF-LO With Confidence Example</h1>
<p id="rfc.section.6.4.p.1">The PIDF-LO document in <a href="#ex-conf">Figure 11</a> includes a representation of uncertainty as a circular area.  The confidence element (on the line marked with a comment) indicates that the confidence is 67% and that it follows a normal distribution.  </p>
<div id="rfc.figure.11"/>
<div id="ex-conf"/>
<pre>
  &lt;pidf:presence
      xmlns:pidf="urn:ietf:params:xml:ns:pidf"
      xmlns:dm="urn:ietf:params:xml:ns:pidf:data-model"
      xmlns:gp="urn:ietf:params:xml:ns:pidf:geopriv10"
      xmlns:gs="http://www.opengis.net/pidflo/1.0"
      xmlns:gml="http://www.opengis.net/gml"
      xmlns:con="urn:ietf:params:xml:ns:pidf:geopriv:conf"
      entity="pres:alice@example.com"&gt;
    &lt;dm:device id="sg89ab"&gt;
      &lt;pidf:status&gt;
        &lt;gp:geopriv&gt;
          &lt;gp:location-info&gt;
            &lt;gs:Circle srsName="urn:ogc:def:crs:EPSG::4326"&gt;
              &lt;gml:pos&gt;42.5463 -73.2512&lt;/gml:pos&gt;
              &lt;gs:radius uom="urn:ogc:def:uom:EPSG::9001"&gt;
                850.24
              &lt;/gs:radius&gt;
            &lt;/gs:Circle&gt;
&lt;!-- c --&gt;  &lt;con:confidence pdf="normal"&gt;67&lt;/con:confidence&gt;
          &lt;/gp:location-info&gt;
          &lt;gp:usage-rules/&gt;
        &lt;/gp:geopriv&gt;
      &lt;/pidf:status&gt;
      &lt;dm:deviceID&gt;mac:010203040506&lt;/dm:deviceID&gt;
    &lt;/dm:device&gt;
  &lt;/pidf:presence&gt;
</pre>
<p class="figure">Figure 11: Example PIDF-LO with Confidence</p>
<h1 id="rfc.section.7"><a href="#rfc.section.7">7.</a> <a href="#schema" id="schema">Confidence Schema</a></h1>
<pre>
&lt;?xml version="1.0"?&gt;
&lt;xs:schema
    xmlns:conf="urn:ietf:params:xml:ns:geopriv:conf"
    xmlns:xs="http://www.w3.org/2001/XMLSchema"
    targetNamespace="urn:ietf:params:xml:ns:geopriv:conf"
    elementFormDefault="qualified"
    attributeFormDefault="unqualified"&gt;

  &lt;xs:annotation&gt;
    &lt;xs:appinfo
        source="urn:ietf:params:xml:schema:geopriv:conf"&gt;
      PIDF-LO Confidence
    &lt;/xs:appinfo&gt;
    &lt;xs:documentation source="http://www.ietf.org/rfc/rfcXXXX.txt"&gt;
      &lt;!-- [[NOTE TO RFC-EDITOR: Please replace above URL with URL of
           published RFC and remove this note.]] --&gt;
      This schema defines an element that is used for indicating
      confidence in PIDF-LO documents.
    &lt;/xs:documentation&gt;
  &lt;/xs:annotation&gt;

  &lt;xs:element name="confidence" type="conf:confidenceType"/&gt;
  &lt;xs:complexType name="confidenceType"&gt;
    &lt;xs:simpleContent&gt;
      &lt;xs:extension base="conf:confidenceBase"&gt;
        &lt;xs:attribute name="pdf" type="conf:pdfType"
                      default="unknown"/&gt;
      &lt;/xs:extension&gt;
    &lt;/xs:simpleContent&gt;
  &lt;/xs:complexType&gt;
  &lt;xs:simpleType name="confidenceBase"&gt;
  &lt;xs:union&gt;
    &lt;xs:restriction base="xs:decimal"&gt;
      &lt;xs:minInclusive value="0.0"/&gt;
      &lt;xs:maxInclusive value="100.0"/&gt;
    &lt;/xs:restriction&gt;
    &lt;xs:restriction base="xs:token"&gt;
      &lt;xs:enumeration value="unknown"/&gt;
    &lt;/xs:restriction&gt;
  &lt;/xs:simpleType&gt;
  &lt;xs:simpleType name="pdfType"&gt;
    &lt;xs:restriction base="xs:token"&gt;
      &lt;xs:enumeration value="unknown"/&gt;
      &lt;xs:enumeration value="normal"/&gt;
      &lt;xs:enumeration value="rectangular"/&gt;
    &lt;/xs:restriction&gt;
  &lt;/xs:simpleType&gt;
&lt;/xs:schema&gt;
</pre>
<h1 id="rfc.section.8"><a href="#rfc.section.8">8.</a> <a href="#iana" id="iana">IANA Considerations</a></h1>
<h1 id="rfc.section.8.1"><a href="#rfc.section.8.1">8.1.</a> URN Sub-Namespace Registration for urn:ietf:params:xml:ns:geopriv:conf</h1>
<pre>
      BEGIN
        &lt;?xml version="1.0"?&gt;
        &lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
          "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"&gt;
        &lt;html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"&gt;
          &lt;head&gt;
            &lt;title&gt;PIDF-LO Confidence Attribute&lt;/title&gt;
          &lt;/head&gt;
          &lt;body&gt;
            &lt;h1&gt;Namespace for PIDF-LO Confidence Attribute&lt;/h1&gt;
            &lt;h2&gt;urn:ietf:params:xml:ns:geopriv:conf&lt;/h2&gt;
[[NOTE TO IANA/RFC-EDITOR: Please update RFC URL and replace XXXX
    with the RFC number for this specification.]]
            &lt;p&gt;See &lt;a href="[[RFC URL]]"&gt;RFCXXXX&lt;/a&gt;.&lt;/p&gt;
          &lt;/body&gt;
        &lt;/html&gt;
      END
</pre>
<p id="rfc.section.8.1.p.1">This section registers a new XML namespace, <samp>urn:ietf:params:xml:ns:geopriv:conf</samp>, as per the guidelines in <a href="#RFC3688">[RFC3688]</a>.  </p>

<dl>
  <dt>URI:</dt>
  <dd style="margin-left: 8">urn:ietf:params:xml:ns:geopriv:conf </dd>
  <dt>Registrant Contact:</dt>
  <dd style="margin-left: 8">IETF, GEOPRIV working group, (geopriv@ietf.org), Martin Thomson (martin.thomson@gmail.com).  </dd>
  <dt>XML:</dt>
  <dd style="margin-left: 8"/>
</dl>

<p> </p>
<h1 id="rfc.section.8.2"><a href="#rfc.section.8.2">8.2.</a> XML Schema Registration</h1>
<p id="rfc.section.8.2.p.1">This section registers an XML schema as per the guidelines in <a href="#RFC3688">[RFC3688]</a>.  </p>

<dl>
  <dt>URI:</dt>
  <dd style="margin-left: 8">urn:ietf:params:xml:schema:geopriv:conf</dd>
  <dt>Registrant Contact:</dt>
  <dd style="margin-left: 8">IETF, GEOPRIV working group, (geopriv@ietf.org), Martin Thomson (martin.thomson@gmail.com).  </dd>
  <dt>Schema:</dt>
  <dd style="margin-left: 8">The XML for this schema can be found as the entirety of <a href="#schema">Section 7</a> of this document.  </dd>
</dl>

<p> </p>
<h1 id="rfc.section.9"><a href="#rfc.section.9">9.</a> <a href="#security" id="security">Security Considerations</a></h1>
<p id="rfc.section.9.p.1">This document describes methods for managing and manipulating uncertainty in location.  No specific security concerns arise from most of the information provided.  </p>
<p id="rfc.section.9.p.2">Adding confidence to location information risks misinterpretation by consumers of location that do not understand the element.  This could be exploited, particularly when reducing confidence, since the resulting uncertainty region might include locations that are less likely to contain the target than the recipient expects.  Since this sort of error is always a possibility, the impact of this is low.  </p>
<h1 id="rfc.section.10"><a href="#rfc.section.10">10.</a> <a href="#ack" id="ack">Acknowledgements</a></h1>
<p id="rfc.section.10.p.1">Peter Rhodes provided assistance with some of the mathematical groundwork on this document.  Dan Cornford provided a detailed review and many terminology corrections.  </p>
<h1 id="rfc.references"><a href="#rfc.references">11.</a> References</h1>
<h1 id="rfc.references.1"><a href="#rfc.references.1">11.1.</a> Normative References</h1>
<table>
  <tbody>
    <tr>
      <td class="reference">
        <b id="RFC2119">[RFC2119]</b>
      </td>
      <td class="top"><a href="mailto:sob@harvard.edu" title="Harvard University">Bradner, S.</a>, "<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, March 1997.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC3688">[RFC3688]</b>
      </td>
      <td class="top"><a>Mealling, M.</a>, "<a href="http://tools.ietf.org/html/rfc3688">The IETF XML Registry</a>", BCP 81, RFC 3688, January 2004.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC4119">[RFC4119]</b>
      </td>
      <td class="top"><a>Peterson, J.</a>, "<a href="http://tools.ietf.org/html/rfc4119">A Presence-based GEOPRIV Location Object Format</a>", RFC 4119, December 2005.</td>
    </tr>
  </tbody>
</table>
<h1 id="rfc.references.2"><a href="#rfc.references.2">11.2.</a> Informative References</h1>
<table>
  <tbody>
    <tr>
      <td class="reference">
        <b id="Convert">[Convert]</b>
      </td>
      <td class="top"><a title="Ferris State University">Burtch, R.</a>, "<a>A Comparison of Methods Used in Rectangular to Geodetic Coordinate Transformations</a>", April 2006.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="GeoShape">[GeoShape]</b>
      </td>
      <td class="top"><a title="Andrew Corporation">Thomson, M.</a> and <a title="Open Geospatial Consortium Inc.">C. Reed</a>, "<a>GML 3.1.1 PIDF-LO Shape Application Schema for use by the Internet Engineering Task Force (IETF)</a>", Candidate OpenGIS Implementation Specification 06-142r1, Version: 1.0, April 2007.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="I-D.thomson-geopriv-location-obscuring">[I-D.thomson-geopriv-location-obscuring]</b>
      </td>
      <td class="top"><a>Thomson, M.</a>, "<a href="http://tools.ietf.org/html/draft-thomson-geopriv-location-obscuring-03">Obscuring Location</a>", Internet-Draft draft-thomson-geopriv-location-obscuring-03, June 2011.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="ISO.GUM">[ISO.GUM]</b>
      </td>
      <td class="top"><a>ISO/IEC</a>, "<a>Guide to the expression of uncertainty in measurement (GUM)</a>", Guide 98:1995, 1995.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="NIST.TN1297">[NIST.TN1297]</b>
      </td>
      <td class="top"><a title="NIST">Taylor, B.</a> and <a title="NIST">C. Kuyatt</a>, "<a>Guidelines for Evaluating and Expressing the Uncertainty of NIST Measurement Results</a>", Technical Note 1297, Sep 1994.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC3693">[RFC3693]</b>
      </td>
      <td class="top"><a>Cuellar, J.</a>, <a>Morris, J.</a>, <a>Mulligan, D.</a>, <a>Peterson, J.</a> and <a>J. Polk</a>, "<a href="http://tools.ietf.org/html/rfc3693">Geopriv Requirements</a>", RFC 3693, February 2004.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC5139">[RFC5139]</b>
      </td>
      <td class="top"><a>Thomson, M.</a> and <a>J. Winterbottom</a>, "<a href="http://tools.ietf.org/html/rfc5139">Revised Civic Location Format for Presence Information Data Format Location Object (PIDF-LO)</a>", RFC 5139, February 2008.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC5222">[RFC5222]</b>
      </td>
      <td class="top"><a>Hardie, T.</a>, <a>Newton, A.</a>, <a>Schulzrinne, H.</a> and <a>H. Tschofenig</a>, "<a href="http://tools.ietf.org/html/rfc5222">LoST: A Location-to-Service Translation Protocol</a>", RFC 5222, August 2008.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC5491">[RFC5491]</b>
      </td>
      <td class="top"><a>Winterbottom, J.</a>, <a>Thomson, M.</a> and <a>H. Tschofenig</a>, "<a href="http://tools.ietf.org/html/rfc5491">GEOPRIV Presence Information Data Format Location Object (PIDF-LO) Usage Clarification, Considerations, and Recommendations</a>", RFC 5491, March 2009.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC6225">[RFC6225]</b>
      </td>
      <td class="top"><a>Polk, J.</a>, <a>Linsner, M.</a>, <a>Thomson, M.</a> and <a>B. Aboba</a>, "<a href="http://tools.ietf.org/html/rfc6225">Dynamic Host Configuration Protocol Options for Coordinate-Based Location Configuration Information</a>", RFC 6225, July 2011.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC6280">[RFC6280]</b>
      </td>
      <td class="top"><a>Barnes, R.</a>, <a>Lepinski, M.</a>, <a>Cooper, A.</a>, <a>Morris, J.</a>, <a>Tschofenig, H.</a> and <a>H. Schulzrinne</a>, "<a href="http://tools.ietf.org/html/rfc6280">An Architecture for Location and Location Privacy in Internet Applications</a>", BCP 160, RFC 6280, July 2011.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="Sunday02">[Sunday02]</b>
      </td>
      <td class="top"><a>Sunday, D.</a>, "<a href="http://www.acm.org/jgt/papers/Sunday02/">Fast polygon area and Newell normal computation</a>", Journal of Graphics Tools JGT, 7(2):9-13,2002, 2002.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="TS-3GPP-23_032">[TS-3GPP-23_032]</b>
      </td>
      <td class="top"><a>3GPP</a>, "<a>Universal Geographic Area Description (GAD)</a>", 3GPP TS 23.032 11.0.0, September 2012.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="Vatti92">[Vatti92]</b>
      </td>
      <td class="top"><a>Vatti, B.</a>, "<a href="http://portal.acm.org/citation.cfm?id=129906 ">A generic solution to polygon clipping</a>", Communications of the ACM Vol35, Issue7, pp56-63, 1992.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="WGS84">[WGS84]</b>
      </td>
      <td class="top"><a>US National Imagery and Mapping Agency</a>, "<a>Department of Defense (DoD) World Geodetic System 1984 (WGS 84), Third Edition</a>", NIMA TR8350.2, January 2000.</td>
    </tr>
  </tbody>
</table>
<h1 id="rfc.appendix.A"><a href="#rfc.appendix.A">Appendix A.</a> <a href="#ecef2geo" id="ecef2geo">Conversion Between Cartesian and Geodetic Coordinates in WGS84</a></h1>
<p id="rfc.section.A.p.1">The process of conversion from geodetic (latitude, longitude and altitude) to earth-centered, earth-fixed (ECEF) Cartesian coordinates is relatively simple.  </p>
<p id="rfc.section.A.p.2">In this section, the following constants and derived values are used from the definition of <a href="#WGS84">WGS84</a> <cite title="NONE">[WGS84]</cite>: </p>

<ul class="empty">
  <li>{radius of ellipsoid} R = 6378137 meters </li>
  <li>{inverse flattening} 1/f = 298.257223563 </li>
  <li>{first eccentricity squared} e^2 = f * (2 - f) </li>
  <li>{second eccentricity squared} e'^2 = e^2 * (1 - e^2) </li>
</ul>

<p> </p>
<p id="rfc.section.A.p.3">To convert geodetic coordinates (latitude, longitude, altitude) to ECEF coordinates (X, Y, Z), use the following relationships: </p>

<ul class="empty">
  <li>N = R / sqrt(1 - e^2 * sin(latitude)^2) </li>
  <li>X = (N + altitude) * cos(latitude) * cos(longitude) </li>
  <li>Y = (N + altitude) * cos(latitude) * sin(longitude) </li>
  <li>Z = (N*(1 - e^2) + altitude) * sin(latitude) </li>
</ul>

<p> </p>
<p id="rfc.section.A.p.4">The reverse conversion requires more complex computation and most methods introduce some error in latitude and altitude.  A range of techniques are described in <a href="#Convert">[Convert]</a>.  A variant on the method originally proposed by Bowring, which results in an acceptably small error, is described by the following: <samp>p&#160;&lt;&#160;1</samp>, the value for altitude that this method produces is unstable.  A simpler method for determining the altitude of a point near the poles is: </p>

<ul class="empty">
  <li>p = sqrt(X^2 + Y^2) </li>
  <li>r = sqrt(X^2 + Y^2 + Z^2) </li>
  <li>u = atan((1-f) * Z * (1 + e'^2 * (1-f) * R / r) / p) </li>
  <li>latitude = atan((Z + e'^2 * (1-f) * R * sin(u)^3) /&#160;(p&#160;-&#160;e^2&#160;*&#160;R&#160;*&#160;cos(u)^3)) </li>
  <li>longitude = atan2(Y, X) </li>
  <li>altitude = sqrt((p - R * cos(u))^2 +&#160;(Z&#160;-&#160;(1-f)&#160;*&#160;R&#160;*&#160;sin(u))^2) </li>
</ul>

<p> If the point is near the poles, that is </p>

<ul class="empty">
  <li>altitude = |Z| - R * (1 - f) </li>
</ul>

<p> </p>
<h1 id="rfc.appendix.B"><a href="#rfc.appendix.B">Appendix B.</a> <a href="#polygonupnormal" id="polygonupnormal">Calculating the Upward Normal of a Polygon</a></h1>
<p id="rfc.section.B.p.1">For a polygon that is guaranteed to be convex and coplanar, the upward normal can be found by finding the vector cross product of adjacent edges.  </p>
<p id="rfc.section.B.p.2">For more general cases the Newell method of approximation described in <a href="#Sunday02">[Sunday02]</a> may be applied.  In particular, this method can be used if the points are only approximately coplanar, and for non-convex polygons.  </p>
<p id="rfc.section.B.p.3">This process requires a Cartesian coordinate system.  Therefore, <a href="#ecef2geo">convert the geodetic coordinates of the polygon to Cartesian, ECEF coordinates</a> <cite title="NONE">[ecef2geo]</cite>.  If no altitude is specified, assume an altitude of zero.  </p>
<p id="rfc.section.B.p.4">This method can be condensed to the following set of equations: <samp>(x[1],&#160;y[1],&#160;z[1])</samp> through <samp>(x[n],&#160;y[n],&#160;x[n])</samp>.  Each array is treated as circular, that is, <samp>x[0]&#160;==&#160;x[n]</samp> and <samp>x[n+1]&#160;==&#160;x[1]</samp>.  </p>

<ul class="empty">
  <li>Nx = sum from i=1..n of (y[i] * (z[i+1] - z[i-1])) </li>
  <li>Ny = sum from i=1..n of (z[i] * (x[i+1] - x[i-1])) </li>
  <li>Nz = sum from i=1..n of (x[i] * (y[i+1] - y[i-1])) </li>
</ul>

<p> For these formulae, the polygon is made of points </p>
<p id="rfc.section.B.p.5">To translate this into a unit-vector; divide each component by the length of the vector: </p>

<ul class="empty">
  <li>Nx' = Nx / sqrt(Nx^2 + Ny^2 + Nz^2) </li>
  <li>Ny' = Ny / sqrt(Nx^2 + Ny^2 + Nz^2) </li>
  <li>Nz' = Nz / sqrt(Nx^2 + Ny^2 + Nz^2) </li>
</ul>

<p> </p>
<h1 id="rfc.appendix.B.1"><a href="#rfc.appendix.B.1">B.1.</a> <a href="#polygonup" id="polygonup">Checking that a Polygon Upward Normal Points Up</a></h1>
<p><a href="#RFC5491">RFC 5491</a> <cite title="NONE">[RFC5491]</cite> stipulates that polygons be presented in anti-clockwise direction so that the upward normal is in an upward direction.  Accidental reversal of points can invert this vector.  This error can be hard to detect just by looking at the series of coordinates that form the polygon.  </p>
<p id="rfc.section.B.1.p.2">Calculate the dot product of the <a href="#polygonupnormal">upward normal of the polygon</a> <cite title="NONE">[polygonupnormal]</cite> and any vector that points away from the center of the Earth from the location of polygon.  If this product is positive, then the polygon upward normal also points away from the center of the Earth.  </p>

<ul class="empty">
  <li>The inverse cosine of this value indicates the angle between the horizontal plane and the approximate plane of the polygon.  </li>
</ul>

<p> </p>
<p id="rfc.section.B.1.p.3">A unit vector for the upward direction at any point can be found based on the latitude (lat) and longitude (lng) of the point, as follows: </p>

<ul class="empty">
  <li>Up = [ cos(lat) * cos(lng) ; cos(lat) * sin(lng) ; sin(lat) ]</li>
</ul>

<p> </p>
<p id="rfc.section.B.1.p.4">For polygons that span less than half the globe, any point in the polygon - including the centroid - can be selected to generate an approximate up vector for comparison with the upward normal.  </p>
<h1 id="rfc.authors">
  <a href="#rfc.authors">Authors' Addresses</a>
</h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Martin Thomson</span> 
	  <span class="n hidden">
		<span class="family-name">Thomson</span>
	  </span>
	</span>
	<span class="org vcardline">Mozilla</span>
	<span class="adr">
	  <span class="vcardline">331 E Evelyn Street</span>

	  <span class="vcardline">
		<span class="locality">Mountain View</span>,  
		<span class="region">CA</span> 
		<span class="code">94041</span>
	  </span>
	  <span class="country-name vcardline">US</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:martin.thomson@gmail.com">martin.thomson@gmail.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">James Winterbottom</span> 
	  <span class="n hidden">
		<span class="family-name">Winterbottom</span>
	  </span>
	</span>
	<span class="org vcardline">Unaffiliated</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality"></span> 
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline">AU</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:a.james.winterbottom@gmail.com">a.james.winterbottom@gmail.com</a></span>

  </address>
</div>

</body>
</html>
